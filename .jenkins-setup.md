# Jenkins Setup Guide for CRM Automation Tests

## Prerequisites

1. Jenkins installed and running
2. Required Jenkins plugins:
   - Pipeline
   - Git
   - Maven Integration
   - Cucumber Reports
   - JUnit
   - Email Extension (optional for notifications)

## Jenkins Configuration Steps

### 1. Configure Global Tools

Go to **Manage Jenkins → Global Tool Configuration**:

**Maven Configuration:**

- Name: `Maven3`
- Install automatically: Yes
- Version: 3.9.x or higher

**JDK Configuration:**

- Name: `JDK17`
- Install automatically: Yes
- Version: Java 17

### 2. Create New Pipeline Job

1. Click **New Item**
2. Enter name: `CRM-Smoke-Tests-Daily`
3. Select **Pipeline**
4. Click **OK**

### 3. Configure Pipeline

In the job configuration:

**General:**

- Description: `Automated CRM smoke tests running daily at 10 PM`

**Build Triggers:**

- ✅ Build periodically
- Schedule: `0 22 * * *` (10 PM daily)

**Pipeline:**

- Definition: `Pipeline script from SCM`
- SCM: `Git`
- Repository URL: `<your-git-repo-url>`
- Branch: `*/main` (or your branch name)
- Script Path: `Jenkinsfile`

**Or for inline script:**

- Definition: `Pipeline script`
- Paste the Jenkinsfile content directly

### 4. Cron Syntax Reference

```
┌───────────── minute (0 - 59)
│ ┌───────────── hour (0 - 23)
│ │ ┌───────────── day of month (1 - 31)
│ │ │ ┌───────────── month (1 - 12)
│ │ │ │ ┌───────────── day of week (0 - 7) (Sunday=0 or 7)
│ │ │ │ │
│ │ │ │ │
* * * * *
```

**Examples:**

- `0 22 * * *` - Every day at 10 PM
- `0 22 * * 1-5` - Weekdays at 10 PM
- `0 9,22 * * *` - Every day at 9 AM and 10 PM
- `H 22 * * *` - Every day around 10 PM (load balanced)

### 5. Feature File Tagging

Make sure your feature files have appropriate tags:

```gherkin
@smoke @login
Feature: User Login

@smoke @regression
Scenario: Successful login
  Given user is on the login page
  ...
```

### 6. Run Test Manually

Before scheduling, test manually:

1. Click **Build with Parameters**
2. Select `TEST_SUITE`: `smoke`
3. Click **Build**

### 7. Email Notifications (Optional)

Uncomment email sections in Jenkinsfile and configure:

- Go to **Manage Jenkins → Configure System**
- Find **Extended E-mail Notification**
- Configure SMTP server settings

## Running Different Test Suites

### Command Line Options

```bash
# Smoke tests only
mvn test -Dcucumber.filter.tags="@smoke"

# Regression tests only
mvn test -Dcucumber.filter.tags="@regression"

# Specific feature
mvn test -Dcucumber.features="src/test/resources/features/US_01_LoginPage.feature"

# Multiple tags
mvn test -Dcucumber.filter.tags="@smoke and @login"

# Exclude tags
mvn test -Dcucumber.filter.tags="not @wip"
```

## Jenkinsfile vs Groovy Script

### Use Declarative Jenkinsfile (Recommended) when:

- ✅ You want readable, maintainable code
- ✅ You need version control for CI/CD
- ✅ You're new to Jenkins
- ✅ You want built-in features (triggers, post actions)

### Use Scripted Groovy when:

- Complex conditional logic needed
- Dynamic pipeline generation
- Advanced Groovy features required

## Reports Location

After build completes, reports are available:

- **Cucumber Report**: Click job → Cucumber Reports
- **JUnit Report**: Click job → Test Result
- **HTML Report**: Click job → Build Artifacts → cucumber-reports.html
- **Public Link**: Check console output for cucumber.io link

## Troubleshooting

**Issue: Tests don't run**

- Check Maven and JDK are configured correctly
- Verify `dryRun = false` in CukesRunner.java

**Issue: Scheduled build doesn't trigger**

- Verify cron syntax
- Check Jenkins system time: `date` in Jenkins script console
- Look at Jenkins logs

**Issue: Reports not published**

- Install Cucumber Reports Plugin
- Check file paths in post section

## Best Practices

1. Use `H` for distributed load: `H 22 * * *` instead of `0 22 * * *`
2. Keep Jenkinsfile in version control
3. Tag features appropriately (@smoke, @regression)
4. Set up notifications for failures
5. Archive test reports
6. Clean workspace after builds
7. Use parameters for flexibility
